#ifndef _PONYLIB_WIN32U
#define _PONYLIB_WIN32U

#include "ponylib.h"

#include <functional>
#include <vector>
#include <algorithm>


namespace ponylib::win32u {
    /*
        Win32U API Proxies
    */
    using nt_d_composition_create_channel_t = system_function_t<
        NTSTATUS (NTAPI*)(
            PHANDLE phChannel,
            PSIZE_T pSectionSize,
            PVOID*  pMappedAddress
        )
    >;
    using nt_d_composition_destroy_channel_t = system_function_t<
        NTSTATUS(NTAPI*)(
            HANDLE hChannel
        )
    >;
    using nt_d_composition_process_channel_batch_buffer_t = system_function_t<
        NTSTATUS(NTAPI*)(
            HANDLE hChannel,
            DWORD  dwArgStart,
            PDWORD pOutArg1,
            PDWORD pOutArg2
        )
    >;
    using nt_d_composition_commit_channel_t = system_function_t<
        NTSTATUS(NTAPI*)(
            HANDLE  hChannel,
            LPDWORD out1,
            LPBOOL  out2,
            BOOL    flag,
            HANDLE  Object,
            PVOID   a6,
            PVOID   a7,
            DWORD   a8
        )
    >;
    using nt_d_composition_create_and_bind_shared_section_t = system_function_t<
        NTSTATUS(NTAPI*)(
            HANDLE hChannel,
            UINT32 hSharedSection,
            SIZE_T szSharedSection,
            PHANDLE phSection
        )
    >;
    using nt_user_create_dcomposition_hwnd_target_t = system_function_t<
        NTSTATUS(NTAPI*)(
            HWND    hwnd,
            BOOL    topmost,
            PHANDLE phwnd
        )
    >;
    using nt_user_destroy_dcomposition_hwnd_target = system_function_t<
        NTSTATUS(NTAPI*)(
            HWND hwnd,
            HANDLE hcomp
        )
    >;

    /*
        Win32U API Proxies constants
    */
    extern nt_d_composition_create_channel_t                 kNtDCompositionCreateChannel;
    extern nt_d_composition_destroy_channel_t                kNtDCompositionDestroyChannel;
    extern nt_d_composition_process_channel_batch_buffer_t   kNtDCompositionProcessChannelBatchBuffer;
    extern nt_d_composition_commit_channel_t                 kNtDCompositionCommitChannel;
    extern nt_d_composition_create_and_bind_shared_section_t kNtDCompositionCreateAndBindSharedSection;
    extern nt_user_create_dcomposition_hwnd_target_t         kNtUserCreateDCompositionHwndTarget;
    extern nt_user_destroy_dcomposition_hwnd_target          kNtUserDestroyDCompositionHwndTarget;
};

#endif // _PONYLIB_WIN32U